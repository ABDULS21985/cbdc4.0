events {
    worker_connections 1024;
}

http {
    upstream auth_service {
        server auth-service:8081;
    }

    upstream wallet_service {
        server wallet-service:8082;
    }

    upstream payments_service {
        server payments-service:8083;
    }

    server {
        listen 80;
        server_name api.cbdc.centralbank;

        # Redirect HTTP to HTTPS (in prod)
        # return 301 https://$host$request_uri;

        location /auth/ {
            proxy_pass http://auth_service;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        location /wallets/ {
            proxy_pass http://wallet_service;
            proxy_set_header Host $host;
        }

        location /payments/ {
            proxy_pass http://payments_service;
            proxy_set_header Host $host;
        }
    }

    # SSL Configuration (Commented out for local dev without certs)
    # server {
    #     listen 443 ssl;
    #     server_name api.cbdc.centralbank;
    #     ssl_certificate /etc/nginx/certs/api.crt;
    #     ssl_certificate_key /etc/nginx/certs/api.key;
    #     ...
    # }
}
